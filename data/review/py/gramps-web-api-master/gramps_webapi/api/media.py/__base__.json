{"embedding": [0.24520404636859894, -0.8897238373756409, -1.3196841478347778, 0.5945742130279541, 0.5611090660095215, -0.6734838485717773, -0.21106289327144623, 0.6152971982955933, -0.63547682762146, -0.07460805028676987, -0.02134851925075054, -0.06874857097864151, -0.027164926752448082, 0.2207295149564743, 0.14122751355171204, 0.41661331057548523, 0.06228066235780716, 0.1479659527540207, 0.7679700255393982, -0.025892972946166992, -0.27678290009498596, 0.5493949055671692, 0.35641810297966003, 0.3717345893383026, -0.16372297704219818, 0.39129629731178284, 0.19934122264385223, -0.054046936333179474, 0.70558762550354, -0.40865564346313477, 0.4833901524543762, -0.12898872792720795, 0.8720563054084778, 0.35141482949256897, 0.031236344948410988, -0.2610829472541809, 0.18607304990291595, 0.47063058614730835, -1.5594801902770996, -0.18416383862495422, -0.5597862601280212, 0.47351333498954773, 0.3016853630542755, -0.5121177434921265, 0.5521410703659058, 1.0150867700576782, -0.7503458261489868, -0.08482382446527481, 0.44601649045944214, 0.5128507018089294, 0.09584655612707138, 0.667635977268219, -0.25528809428215027, -0.05362643674015999, 0.31767982244491577, 0.9295611381530762, -0.20315246284008026, 0.08995531499385834, -0.0005542783183045685, -0.4734773337841034, 0.4094129204750061, 0.34346964955329895, 0.8418641686439514, -0.570564329624176, 0.15363578498363495, -0.28110426664352417, -0.6007719039916992, -0.1702134907245636, -0.4878218472003937, 0.2615422010421753, -0.506217360496521, -0.6710610389709473, 0.1697588413953781, 0.17992492020130157, -0.20119240880012512, -0.12639637291431427, 0.32867431640625, -0.5334113836288452, 0.3196296691894531, 0.056906964629888535, 0.8272584080696106, -1.2484091520309448, -0.22410303354263306, 0.3124086558818817, 1.039923906326294, 0.09224475920200348, 0.5322279930114746, -0.4659237563610077, -0.7337064743041992, 0.3320242166519165, -0.7857480049133301, 0.009371737018227577, -0.04543254151940346, 0.201421856880188, -0.4062439799308777, -0.4690157473087311, -0.6979891657829285, -0.6774380803108215, -0.41171589493751526, -0.06215398758649826, -0.46157726645469666, 0.28986844420433044, 0.006064945366233587, 0.07995026558637619, 0.2851809561252594, -0.41229501366615295, 0.328629732131958, -0.5359106659889221, -0.1656474471092224, -0.14231224358081818, -0.24853280186653137, -0.7786709070205688, -0.38902783393859863, 0.1397087424993515, -0.10385922342538834, -0.03794270381331444, 0.19174528121948242, 0.19553984701633453, 0.17828817665576935, -0.6134454607963562, 0.14751777052879333, -0.5804466605186462, 0.14881423115730286, -0.12445853650569916, 1.4229198694229126, 0.026750413700938225, 0.6784520745277405, -0.6139445900917053, -0.38080114126205444, 0.2022564560174942, -0.9973130226135254, 0.9370846152305603, -0.3077423870563507, 0.40959325432777405, -0.17802070081233978, 0.16542355716228485, -0.07256055623292923, -0.31507357954978943, 0.018394246697425842, 0.5862789154052734, 0.009983507916331291, -0.02828161232173443, -0.04058828204870224, -0.8972374796867371, -0.3928656280040741, -0.03369877114892006, 0.36866816878318787, -0.5532324314117432, -0.36927223205566406, -0.24244242906570435, 0.20407433807849884, -0.4309699535369873, -0.2224879115819931, 0.936673641204834, -0.032768674194812775, 0.14857925474643707, 0.09170680493116379, 0.3488069772720337, -0.5380604267120361, 0.1603160798549652, 0.11757805943489075, -0.12544132769107819, -0.550809383392334, -0.7740219235420227, -0.18087171018123627, -0.5125250816345215, 0.18758516013622284, 0.5420435070991516, -0.023611878976225853, 0.27119961380958557, 0.01442362368106842, 0.3435099422931671, -0.11271264404058456, 0.018693655729293823, 0.5860391855239868, 0.9351819157600403, -0.026368357241153717, 0.23520658910274506, 0.09895674139261246, -0.5121879577636719, 0.15216416120529175, -0.5915214419364929, 0.22879661619663239, 0.47125443816185, 0.36250439286231995, 0.9781060814857483, -0.18549631536006927, 0.4177455008029938, 0.2844468355178833, 0.08222199231386185, -0.549892783164978, -0.3993481397628784, -0.19708885252475739, -0.6140386462211609, 0.2527838349342346, 0.3105146288871765, 0.8059219121932983, -0.2836356461048126, 0.005891758017241955, 0.47058573365211487, -0.661929190158844, -0.10735277831554413, 0.34552451968193054, -0.6516955494880676, -0.2480720430612564, 0.18727007508277893, 0.6011377573013306, 0.4206922650337219, -0.9854505658149719, 0.09470544755458832, -0.5027027130126953, 0.39375609159469604, -0.022969309240579605, 0.2794904112815857, 0.5895438194274902, -0.7708616256713867, -0.18433938920497894, 0.6265265941619873, 0.062045030295848846, 0.2195807248353958, 0.3629036843776703, 0.3820590376853943, -1.4866951704025269, -0.15719176828861237, 0.2159043401479721, 0.17148883640766144, 0.30986928939819336, 0.35618308186531067, -0.2507815361022949, 0.010907204821705818, -0.06331876665353775, -0.17315156757831573, 0.5201544165611267, 0.6053095459938049, 0.11193408817052841, -0.039432376623153687, 0.5967636108398438, 0.03869737312197685, -0.08320190012454987, -0.3144127428531647, 0.4244686961174011, -0.7569062113761902, -0.15538565814495087, 0.300918847322464, -0.4063199460506439, -0.7318105697631836, -0.05435527116060257, 0.20153160393238068, 0.2634728252887726, -0.33231425285339355, 0.6375373601913452, 0.3932691216468811, -0.20359884202480316, -0.057607803493738174, -0.13115587830543518, -0.3090289831161499, -0.19620904326438904, -0.2153957337141037, 0.20918695628643036, -0.6199721097946167, 0.03697659820318222, -0.9353134036064148, 0.28831946849823, 0.12916633486747742, -0.421099454164505, -0.04033931344747543, 0.3559069037437439, -0.4564611315727234, -0.18722152709960938, 0.079585000872612, 0.6636770963668823, 0.9473720788955688, -0.3327593207359314, -0.27531227469444275, -0.39609581232070923, -0.5566043853759766, -0.29531192779541016, 0.7190986275672913, -0.36527860164642334, -0.35809001326560974, -0.15447916090488434, -0.49420294165611267, 0.8715750575065613, -0.208335280418396, 0.604674756526947, 0.4811214804649353, -0.09514663368463516, 0.24505731463432312, 0.1480535864830017, -0.11946959048509598, -0.36833006143569946, 0.45627039670944214, -0.6881033182144165, -0.036921970546245575, -0.16095589101314545, 0.0833572968840599, -1.3340380191802979, -0.1418723165988922, 1.0467151403427124, -0.43172454833984375, -0.5992798805236816, 0.48048192262649536, 1.1805460453033447, 0.06664863973855972, -0.7480636239051819, 0.07597338408231735, 0.7272765040397644, -0.8490861058235168, 0.1408456414937973, 0.272556871175766, 0.4205712080001831, -0.06357679516077042, 0.00010117022611666471, 0.43753287196159363, 0.9025463461875916, 0.7310066819190979, 0.21448972821235657, 0.8244940638542175, -0.21004021167755127, 0.7540162801742554, -0.0705731138586998, 0.9785799384117126, 0.3418073356151581, 0.1896987408399582, 0.8226718306541443, -0.9718716740608215, 0.17673450708389282, -0.022995423525571823, 0.15969274938106537, 0.21282219886779785, -0.8315930366516113, 0.49311086535453796, 0.029256273061037064, -0.038008060306310654, -0.08566291630268097, 0.17808839678764343, -0.36226439476013184, -0.8753497004508972, 0.2934061884880066, -0.2560948431491852, 0.3264453411102295, -0.258170485496521, 0.5133997797966003, 0.3489467203617096, -0.2355760633945465, -0.5925694108009338, 1.3355400562286377, -0.536100447177887, 0.13285472989082336, -0.04809089004993439, 0.6779667735099792, -0.5636641383171082, -0.008875773288309574, -0.05182713270187378, 0.3151397407054901, -1.3222066164016724, -0.25746437907218933, -0.3638932406902313, -0.19465398788452148, 0.32651710510253906, 0.04353824630379677, 0.3959454298019409, -0.17705145478248596, 0.336025208234787, 0.5622580051422119, -0.19417481124401093, 0.2907043993473053, -0.044455088675022125, -0.006547518540173769, -0.016686806455254555, 0.35188227891921997, -0.24980059266090393, -1.0362151861190796, -0.26713842153549194, 0.041602082550525665, 0.421169251203537, 0.38155597448349, -0.3525075316429138, -0.9685235023498535, 0.33898061513900757, 0.4329344928264618, 1.0442060232162476, -0.18972934782505035, 0.00044019101187586784, 0.4049932658672333, -0.26246294379234314, 0.4204674959182739, 0.3106178045272827, -0.8204739689826965, 0.39579641819000244, 0.2685478925704956, -0.11278993636369705, 0.49470055103302, -0.38167670369148254, -0.008288800716400146, -0.3594549298286438, -0.38307687640190125, 0.5645427703857422, 0.12740901112556458, 0.48104986548423767, 0.2716670036315918, -0.845679759979248, -0.3843189477920532, 0.8262993097305298, 0.05136287584900856, -0.3120149075984955, 0.5715389251708984, 0.5948245525360107, 0.20807164907455444, 0.7948538064956665, 0.14614230394363403, -0.383174866437912, -0.4918667674064636, 0.2778315842151642, -0.07691190391778946, 0.01353524997830391, 0.21538366377353668, -0.08274401724338531, -0.3335671126842499, 0.6538698077201843, 0.09391437470912933, 0.721378743648529, 0.6319592595100403, -0.10578607767820358, -0.7015204429626465, -0.48038771748542786, -0.1295405924320221, -0.14743277430534363, -1.3225644826889038, 0.39138445258140564, 0.060263946652412415, 0.6870015859603882, -0.21173954010009766, -0.5215579867362976, 0.4263938367366791, -0.27345532178878784, -0.6065782308578491, -0.25196173787117004, 0.017095400020480156, 0.20358844101428986, 0.10716450214385986, -0.09900019317865372, -0.39571720361709595, 0.14262095093727112, 0.8769169449806213, -0.3346492052078247, -0.6836746335029602, 0.6229290962219238, 0.9041808843612671, 0.21048416197299957, -1.1858935356140137, -0.21368080377578735, 0.2976190447807312, -0.04939015954732895, -0.4117402732372284, -0.5908990502357483, 0.49296069145202637, -0.3817826211452484, -0.42563557624816895, -1.4245949983596802, 0.056673839688301086, -0.34388598799705505, 1.0259281396865845, -0.4512442350387573, 0.039132680743932724, 0.6074265241622925, 0.5890112519264221, 0.1854822337627411, -0.5621380805969238, -0.42381688952445984, 0.5239331126213074, 0.26777538657188416, -0.43004435300827026, 0.062409717589616776, 0.604805588722229, -0.13688597083091736, 0.02310333587229252, -0.002605065004900098, 0.37098029255867004, -0.5089771747589111, 0.7273248434066772, -0.7549028396606445, 0.14016327261924744, 0.16437119245529175, -0.2527657151222229, -0.5747504830360413, 0.7082301378250122, -0.15638704597949982, 0.6672562956809998, -0.82237708568573, -0.021835286170244217, 0.37824884057044983, -0.1144813597202301, 0.3436037003993988, -0.03771555423736572, 0.07571502774953842, -0.7756522297859192, 0.3507959842681885, 0.1918213963508606, -0.2815915644168854, 0.5026668906211853, -0.5082373023033142, -0.8782607913017273, -0.11917415261268616, 0.16494695842266083, 0.20914947986602783, -0.3435344099998474, -0.9082729816436768, -0.21660293638706207, -0.37922096252441406, -0.5983527898788452, 0.43467575311660767, -0.5560914874076843, 0.2847874164581299, -0.3066074848175049, 0.5168798565864563, 0.19236277043819427, 0.5412270426750183, 0.2733096480369568, -0.2920926809310913, 0.35479098558425903, -0.759306013584137, 0.3501574993133545, -0.11254511773586273, -0.32994210720062256, -0.18186408281326294, -0.13264723122119904, -0.015691770240664482, 0.7156506776809692, 0.7792618870735168, -0.13976934552192688, 0.4873993992805481, -0.29298046231269836, -0.4701157510280609, 0.00031644446426071227, 0.725955069065094, 0.0070822699926793575, -0.7417188286781311, 0.08805253356695175, -0.30127596855163574, -0.12605655193328857, 0.34563860297203064, -0.777271032333374, -0.5499364733695984, -0.6512385010719299, 0.011234954930841923, -0.08816071599721909, -0.13228529691696167, 1.0812349319458008, -0.9758361577987671, -0.12300373613834381, 0.04798579588532448, 0.5509932041168213, 0.309867799282074, 0.08375538885593414, -0.4793596565723419, 0.32355570793151855, -0.648688793182373, -0.09562724083662033, -0.14156678318977356, -0.006679065525531769, 0.2209293097257614, -1.0075483322143555, 0.23040205240249634, 0.07836399227380753, 0.343401700258255, 0.31752654910087585, 0.7419922351837158, 0.12716028094291687, -0.11792176961898804, -0.4211652874946594, 0.4607093036174774, 0.6415771245956421, -0.7510073781013489, 0.21619592607021332, -0.4291909337043762, -0.3808225393295288, 0.22237084805965424, 0.3005014955997467, -0.9037165641784668, 0.8528867363929749, -0.5749621987342834, 0.4952099025249481, -0.19154241681098938, -0.25054168701171875, -0.7329599857330322, 0.6187542080879211, 0.6913315057754517, -0.25969088077545166, 1.0409928560256958, -0.49799832701683044, 0.2480420172214508, -0.006645547691732645, -0.48288753628730774, -0.0016802189638838172, 0.7110562920570374, -0.4736100137233734, 0.07921160012483597, -0.01969970017671585, 0.3117218613624573, -0.4616584777832031, 0.07808692753314972, -0.6252021789550781, -0.1820591688156128, -0.04057964310050011, 0.19380025565624237, 0.09018990397453308, 0.4732469618320465, 0.126641184091568, -0.22340020537376404, -0.7310544848442078, 0.08808920532464981, 0.21518555283546448, 0.4614333510398865, 0.2518440783023834, 0.2938433587551117, -0.8443762063980103, 1.0500038862228394, 0.5933730006217957, -0.34633147716522217, -0.6354247331619263, -0.22215524315834045, -0.4100691080093384, 0.10907149314880371, 0.00023052465985529125, 0.2857728898525238, 0.1764201819896698, 0.19126442074775696, -0.6242625117301941, -0.1573963761329651, 0.04519139602780342, -0.5655171275138855, 0.9692636132240295, 0.12336334586143494, 0.6184545159339905, -0.019148891791701317, -0.36722368001937866, -0.1181059256196022, -0.46138444542884827, 0.17632144689559937, 0.6400600075721741, -0.6359920501708984, -0.4396350681781769, -0.007075113244354725, 0.07159803062677383, 0.5257196426391602, 0.22900605201721191, -0.6452775001525879, -0.06729314476251602, -0.1918962299823761, -0.13626711070537567, 0.4508396089076996, -0.373071551322937, -0.2007957100868225, 0.04387509822845459, 0.4463336169719696, 0.22633537650108337, -0.8155784010887146, -0.12338067591190338, 0.17393602430820465, -0.06531605124473572, -0.848825991153717, 0.6980118155479431, 0.22405105829238892, -0.34069278836250305, -0.46607059240341187, 0.16873358190059662, -0.5939487218856812, 0.8124443292617798, 0.045646246522665024, 0.5885064601898193, 0.19386272132396698, 0.4622476100921631, -0.4232236444950104, -0.3186894655227661, 0.36038514971733093, 0.7113555073738098, -0.10877283662557602, 0.089640773832798, 0.38083523511886597, -0.3135039508342743, 0.24647736549377441, -0.006040734704583883, 0.91526198387146, -0.007718818727880716, -0.16129186749458313, 0.0020050257444381714, 0.11969009786844254, 0.12820017337799072, -0.2329881191253662, 0.2220013290643692, 0.006147337146103382, -0.05166527256369591, -0.3746255040168762, -1.5096914768218994, -0.39362832903862, 0.3882457911968231, 0.27840062975883484, 0.639773428440094, -0.48649126291275024, -0.03773203492164612, -0.28674548864364624, 0.5062208771705627, -0.47190573811531067, 0.15828776359558105, -0.4330812394618988, -0.3484050929546356, -0.17917931079864502, 0.19290800392627716, 0.014988605864346027, 0.08407248556613922, 0.1482657492160797, 0.6049694418907166, -0.05453742295503616, -0.030716560781002045, 0.5622795224189758, 0.03456705063581467, 0.4612954258918762, 0.26646533608436584, -0.30074575543403625, -0.517377495765686, -0.23415173590183258, 0.34589654207229614, 0.37493979930877686, 0.21175435185432434, -0.8292135000228882, -0.1413208693265915, 0.10656419396400452, 0.4428817927837372, 0.45355647802352905, 0.45281994342803955, -0.05794756859540939, -0.35083824396133423, 0.10931646078824997, 0.06971141695976257, -0.5346141457557678, 0.40502819418907166, -0.4230808615684509, -0.2290986180305481, 0.5851627588272095, 0.18377670645713806, -0.4283764064311981, -0.7965812087059021, -0.19770607352256775, 0.24579331278800964, 0.0017760673072189093, 0.6958302855491638, 0.2658134698867798, -0.6192839741706848, 0.4525183439254761, 0.8347256183624268, -0.5099962949752808, 0.006859627552330494, 0.28283950686454773, -0.578208863735199, -0.20514348149299622, -0.04997942969202995, -0.5063948035240173, -0.08769423514604568, -0.2515994906425476, -0.677437961101532, -0.21703128516674042, -0.08986801654100418, 0.09307297319173813, 0.22524335980415344, 0.9421370029449463, -0.53646320104599, 0.23090945184230804], "query": "#\n\n# Gramps Web API - A RESTful API for the Gramps genealogy program\n\n#\n\n# Copyright (C) 2021-2023      David Straub\n\n#\n\n# This program is free software; you can redistribute it and/or modify\n\n# it under the terms of the GNU Affero General Public License as published by\n\n# the Free Software Foundation; either version 3 of the License, or\n\n# (at your option) any later version.\n\n#\n\n# This program is distributed in the hope that it will be useful,\n\n# but WITHOUT ANY WARRANTY; without even the implied warranty of\n\n# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n\n# GNU Affero General Public License for more details.\n\n#\n\n# You should have received a copy of the GNU Affero General Public License\n\n# along with this program. If not, see <https://www.gnu.org/licenses/>.\n\n\n\n\"\"\"Generic media handler.\"\"\"\n\n\nimport os\n\nimport zipfile\n\nfrom pathlib import Path\n\nfrom typing import BinaryIO, Callable, List, Optional, Set\n\n\nfrom flask import current_app\n\nfrom flask_jwt_extended import get_jwt_identity\n\nfrom gramps.gen.db.base import DbReadBase\n\nfrom gramps.gen.lib import Media\n\nfrom gramps.gen.utils.file import expand_media_path\n\n\nfrom ..auth import get_tree_usage, set_tree_usage\n\nfrom ..types import FilenameOrPath\n\nfrom ..util import get_extension\n\nfrom .file import FileHandler, LocalFileHandler, upload_file_local\n\nfrom .s3 import ObjectStorageFileHandler, get_object_keys_size, upload_file_s3\n\nfrom .util import (\n\n    abort_with_message,\n\n    close_db,\n\n    get_db_handle,\n\n    get_db_outside_request,\n\n    get_tree_from_jwt,\n\n)\n\n\nPREFIX_S3 = \"s3://\"\n\n\n\ndef removeprefix(string: str, prefix: str, /) -> str:\n\n    <BODY removeprefix>\n\nclass MediaHandlerBase:\n\n    <BODY MediaHandlerBase>\n\n\nclass MediaHandlerLocal(MediaHandlerBase):\n\n    <BODY MediaHandlerLocal>\n\n\nclass MediaHandlerS3(MediaHandlerBase):\n\n    <BODY MediaHandlerS3>\n\n\ndef MediaHandler(base_dir: Optional[str]) -> MediaHandlerBase:\n\n    <BODY MediaHandler>\n\n\ndef get_media_handler(\n\n    db_handle: DbReadBase, tree: Optional[str] = None\n\n) -> MediaHandlerBase:\n\n    <BODY get_media_handler>\n\n\ndef update_usage_media(\n\n    tree: Optional[str] = None, user_id: Optional[str] = None\n\n) -> int:\n\n    <BODY update_usage_media>\n\n\ndef check_quota_media(\n\n    to_add: int, tree: Optional[str] = None, user_id: Optional[str] = None\n\n) -> None:\n\n    <BODY check_quota_media>", "answer": "{}"}