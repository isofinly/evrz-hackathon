{"start_line": 0, "code": "import { $$appointments } from '@entities/appointments'\n\nimport { chainAppLoaded } from '@routing/chains'\n\nimport { routes } from '@routing/shared'\n\nimport { Appointment, AppointmentStatus } from '@shared/api/webapp/types'\n\nimport { createStore, sample } from 'effector'\n\n\n// <REVIEW>enum \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u044c\u0441\u044f \u0432 \u043e\u0434\u043d\u043e\u043c \u043a\u0430\u0442\u0430\u043b\u043e\u043a\u0435 \u0441 \u0441\u0442\u043e\u0440\u043e\u043c \u0432 \u0444\u0430\u0439\u043b\u0435 \u0441 \u0440\u0430\u0441\u0448\u0438\u0440\u0435\u043d\u0438\u0435\u043ctypes/REVIEW>\nexport enum View {\n\n  TechnicalIssue,\n\n  Loading,\n\n  NoAccess,\n\n  Content,\n\n}\n\n\nfunction checkAccess(appointments: Appointment[]) <BODY checkAccess>\n\nexport const appLoadedRoute = chainAppLoaded(routes.guide)\n\n\n// <REVIEW>\u0445\u0440\u0430\u043d\u0435\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u0432 \u043f\u0435\u0440\u0435\u043c\u0435\u043d\u043d\u043e\u0439 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW> \nexport const $view = createStore<View | null>(null)\n\n\n// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW> \nsample({\n\n  clock: appLoadedRoute.opened,\n\n  source: {\n\n    loading: $$appointments.query.$pending,\n\n    appointments: $$appointments.query.$data,\n\n  },\n\n  fn: ({ loading, appointments }) => {\n\n    if (loading) return View.Loading\n\n    return checkAccess(appointments) ? View.Content : View.NoAccess\n\n  },\n\n  target: $view,\n\n})\n\n\n// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW> \nsample({\n\n  source: $view,\n\n  filter: (view) => view === View.Loading,\n\n  target: $$appointments.query.refresh,\n\n})\n\n\n// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW> \nsample({\n\n  clock: $$appointments.query.finished.success,\n\n  fn: ({ result }) => (checkAccess(result) ? View.Content : View.NoAccess),\n\n  target: $view,\n\n})\n\n\n// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW> \nsample({\n\n  source: $$appointments.query.finished.failure,\n\n  fn: () => View.TechnicalIssue,\n\n  target: $view,\n\n})\n"}