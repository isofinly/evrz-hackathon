{"start_line": 0, "code": "import { Query } from '@farfetched/core'\n\nimport { createFactory } from '@withease/factories'\n\nimport { createEvent, sample } from 'effector'\n\nimport { interval } from 'patronum'\n\n\nexport interface TimeUntilStaleParams <BODY TimeUntilStaleParams>\n\nexport const timeUntilStale = createFactory((params: TimeUntilStaleParams) => {\n\n  const { query, timeout } = params\n\n\n  const start = createEvent()\n\n  const stop = createEvent()\n\n\n  const { tick } = interval({\n\n    start,\n\n    stop,\n\n    timeout,\n\n  })\n\n\n  sample({ clock: query.finished.success, target: start })\n\n  sample({ clock: tick, fn: () => true, target: query.$stale })\n\n  sample({ source: query.$stale, filter: Boolean, target: stop })\n\n})\n"}