useRandomCodeWithSearchParam = (): UseRandomCodeWithSearchReturn => {
    const [searchParams] = useSearchParams()
    const languageName = searchParams.get(searchParamsEnum.languageName)

    const toast = useToast()

    const isGetAllCodes = !languageName || languageName === "Random"

    const {
        data: codesByName,
        isError: isErrorByName,
        isLoading: isLoadingByName
    } = useGetCodeExamplesByName(languageName!, {
        enabled: !isGetAllCodes
    })

    const {
        data: codes,
        isError: isErrorAll,
        isLoading: isLoadingAll
    } = useGetCodeExamples({
        enabled: isGetAllCodes
    })

    const codesForRandom = codesByName ? codesByName : codes

    const [randomText, newText] = useRandom(codesForRandom)
    const [defaultRandomText, newDefaultRandomText] = useRandom(defaultTexts)

    const handleNewTextWithoutNetwork = () => {
        toast({
            title: "No network",
            description: `Backend not found :(. Only ${defaultTexts.length} texts are available.`,
            status: "warning"
        })
        newDefaultRandomText()
    }

    const isLoading = isLoadingByName || isLoadingAll

    if (isErrorByName || isErrorAll) {
        return [
            defaultRandomText,
            {
                isPending: isLoading,
                newText: handleNewTextWithoutNetwork,
                id: undefined
            }
        ]
    }
    return [
        randomText?.content,
        {
            isPending: isLoading,
            newText,
            id: randomText?.UUID
        }
    ]
}