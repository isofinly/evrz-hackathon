import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'
import path from "path";
import { crx } from '@crxjs/vite-plugin'
import manifest from './manifest.json'



export default defineConfig({
	plugins: [
		react(),
		crx({ manifest }),
	],

	build: {
		outDir: path.resolve(__dirname, 'build'),
		manifest:true,
		rollupOptions: {
			output: {
				
				assetFileNames: (assetInfo) => {

					
					let extensionType = assetInfo.name.split('.').at(-1);


					
					if (/png|jpe?g|svg|gif|tiff|bmp|ico/i.test(extensionType)) {
						extensionType = 'img';
					}
					
					else if (/ttf|woff|woff2|otf/i.test(extensionType)){
						extensionType = 'css';
					}

					return `static/${extensionType}/[name]-[hash][extname]`;
				},

				
				chunkFileNames: 'static/js/[name]-[hash].js',

				
				entryFileNames: 'static/js/[name]-[hash].js',
			},
		}
	},
	resolve: {
		alias: {
			'@': path.resolve(__dirname, 'src'),
		}
	}
})