{"start_line": 144, "code": "chainAnonymous = <Params extends RouteParams>(\n\n\troute: RouteInstance<Params>,\n\n\toptions?: ChainedParams\n\n): RouteInstance<Params> => {\n\tconst sessionCheckStarted = createEvent<RouteParamsAndQuery<Params>>();\n\tconst alreadyAnonymous = createEvent();\n\tconst alreadyAuthorized = createEvent();\n\tconst sessionCheckSuccessful = createEvent();\n\tconst sessionCheckFailure = createEvent();\n\n\tconst $paramsAndQuery = combine({\n\t\tparams: route.$params,\n\t\tquery: route.$query,\n\t});\n\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\tsample({\n\t\tclock: sessionCheckStarted,\n\t\tfilter: equals($status, 'initial'),\n\t\ttarget: query.start,\n\t});\n\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\tsample({\n\t\tclock: sessionCheckStarted,\n\t\tsource: $paramsAndQuery,\n\t\tfilter: equals($status, 'anonymous'),\n\t\ttarget: alreadyAnonymous,\n\t});\n\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\tsample({\n\t\tclock: sessionCheckStarted,\n\t\tsource: $paramsAndQuery,\n\t\tfilter: equals($status, 'authorized'),\n\t\ttarget: alreadyAuthorized,\n\t});\n\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\tsample({\n\t\tclock: [alreadyAnonymous, query.finished.failure],\n\t\tsource: $paramsAndQuery,\n\t\tfilter: route.$isOpened,\n\t\ttarget: sessionCheckFailure,\n\t});\n\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\tsample({\n\t\tclock: [alreadyAuthorized, query.finished.success],\n\t\tsource: $paramsAndQuery,\n\t\tfilter: route.$isOpened,\n\t\ttarget: sessionCheckSuccessful,\n\t});\n\n\tif (options?.otherwise) {\n\t\t// <REVIEW>\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts</REVIEW>\n\t\tsample({\n\t\t\tclock: sessionCheckSuccessful,\n\t\t\tfilter: route.$isOpened,\n\t\t\ttarget: options.otherwise as Event<any>,\n\t\t});\n\t}\n\n\treturn chainRoute({\n\t\troute,\n\t\tbeforeOpen: sessionCheckStarted,\n\t\topenOn: sessionCheckFailure,\n\t\tcancelOn: sessionCheckSuccessful,\n\t});\n}"}