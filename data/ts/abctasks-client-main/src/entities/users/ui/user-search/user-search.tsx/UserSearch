UserSearch: React.FC<UserSearchProps> = (props) => {
	const { className, onChange, value, ...rest } = props;
	const users = useSearchedUsers();
	const resetUsers = useUnit(searchUserModel.query.reset);
	const searchChanged = useUnit(searchUserModel.searchChanged);

	const handleChange = (_: unknown, user: User | null) => {
		onChange?.(user);
	};

	const onInputChange = (_: unknown, value: string) => {
		if (value === '') {
			resetUsers();

			return;
		}
		searchChanged(value);
	};

	return (
		<Autocomplete
			className={className}
			options={users.data}
			onChange={handleChange}
			value={value}
			getOptionLabel={(option) => option.username}
			onInputChange={onInputChange}
			renderOption={(props, option) => (
				<TemplateUserListItem {...props} {...option} />
			)}
			renderInput={(params) => <Field {...params} {...rest} />}
		/>
	);
}