{"query": "import { createMutation } from '@farfetched/core';\n\nimport { runtypeContract } from '@farfetched/runtypes';\n\nimport { createDomain, sample } from 'effector';\n\nimport { createForm } from 'effector-forms';\n\nimport Joi from 'joi';\n\nimport { splitMap } from 'patronum';\n\n\nimport { authApi, RegistrationParams, user, User } from '@/shared/api';\n\nimport { MIN_LENGTH, MAX_SHORT_LENGTH } from '@/shared/configs';\n\nimport { createRuleFromSchema, isHttpErrorCode } from '@/shared/lib';\n\nimport { StandardResponse, getStandardResponse } from '@/shared/types';\n\n\nconst registrationDomain = createDomain();\n\n\nconst handlerFx = registrationDomain.effect<\n\n\tRegistrationParams,\n\n\tStandardResponse<User>\n\n>(authApi.registration);\n\n\nexport const mutation = createMutation<\n\n\tRegistrationParams,\n\n\tStandardResponse<User>,\n\n\tStandardResponse<User>,\n\n\tError\n\n>({\n\n\teffect: handlerFx,\n\n\tcontract: runtypeContract(getStandardResponse(user)),\n\n});\n\n\ninterface RegistrationFormParams extends RegistrationParams <BODY RegistrationFormParams>\n\nconst schemas = Joi.object<RegistrationFormParams>({\n\n\temail: Joi.string()\n\n\t\t.min(MIN_LENGTH)\n\n\t\t.max(MAX_SHORT_LENGTH)\n\n\t\t.email({ tlds: { allow: false } })\n\n\t\t.required()\n\n\t\t.messages({\n\n\t\t\t'string.empty': 'empty',\n\n\t\t\t'string.pattern.base': 'pattern',\n\n\t\t\t'string.email': 'email',\n\n\t\t\t'string.min': 'min_length',\n\n\t\t\t'string.max': 'max_length',\n\n\t\t}),\n\n\tusername: Joi.string()\n\n\t\t.min(MIN_LENGTH)\n\n\t\t.max(MAX_SHORT_LENGTH)\n\n\t\t.required()\n\n\t\t.messages({\n\n\t\t\t'string.empty': 'empty',\n\n\t\t\t'string.pattern.base': 'pattern',\n\n\t\t\t'string.min': 'min_length',\n\n\t\t\t'string.max': 'max_length',\n\n\t\t}),\n\n\tpassword: Joi.string()\n\n\t\t.min(MIN_LENGTH)\n\n\t\t.max(MAX_SHORT_LENGTH)\n\n\t\t.required()\n\n\t\t.messages({\n\n\t\t\t'string.empty': 'empty',\n\n\t\t\t'string.pattern.base': 'pattern',\n\n\t\t\t'string.min': 'min_length',\n\n\t\t\t'string.max': 'max_length',\n\n\t\t}),\n\n\trepeatPassword: Joi.string().messages({\n\n\t\t'any.only': 'equal',\n\n\t}),\n\n});\n\n\nexport const form = createForm<RegistrationFormParams>({\n\n\tfields: {\n\n\t\temail: {\n\n\t\t\tinit: '',\n\n\t\t\trules: [createRuleFromSchema('email', schemas.extract('email'))],\n\n\t\t},\n\n\t\tusername: {\n\n\t\t\tinit: '',\n\n\t\t\trules: [createRuleFromSchema('username', schemas.extract('username'))],\n\n\t\t},\n\n\t\tpassword: {\n\n\t\t\tinit: '',\n\n\t\t\trules: [createRuleFromSchema('password', schemas.extract('password'))],\n\n\t\t},\n\n\t\trepeatPassword: {\n\n\t\t\tinit: '',\n\n\t\t\trules: [\n\n\t\t\t\tcreateRuleFromSchema(\n\n\t\t\t\t\t'repeatPassword',\n\n\t\t\t\t\tschemas.extract('repeatPassword')\n\n\t\t\t\t),\n\n\t\t\t],\n\n\t\t},\n\n\t},\n\n});\n\n\nsample({\n\n\tclock: form.formValidated,\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\tfn: ({ repeatPassword: _, ...rest }) => rest,\n\n\ttarget: mutation.start,\n\n});\n\n\nsample({\n\n\tclock: mutation.finished.failure,\n\n\tfn: () => '',\n\n\ttarget: [form.fields.password.$value, form.fields.repeatPassword.$value],\n\n});\n\n\nconst errors = splitMap({\n\n\tsource: mutation.finished.failure,\n\n\tcases: {\n\n\t\tuserAlreadyRegistered: ({ error }) => {\n\n\t\t\tif (isHttpErrorCode(error, 409)) {\n\n\t\t\t\treturn 'exists';\n\n\t\t\t}\n\n\t\t},\n\n\t},\n\n});\n\n\nsample({\n\n\tclock: errors.userAlreadyRegistered,\n\n\tfn: () => false,\n\n\ttarget: form.fields.email.$isValid,\n\n});\n\n\nsample({\n\n\tclock: errors.userAlreadyRegistered,\n\n\tfn: (message) => ({\n\n\t\trule: 'server',\n\n\t\terrorText: message,\n\n\t}),\n\n\ttarget: form.fields.email.addError,\n\n});\n", "answer": "{\"1\": \"\u0421\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0434\u043e\u043c\u0435\u043d\u0430 \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts \",\n\"22\": \"\u0441\u043e\u0437\u0434\u0430\u043d\u0438\u0435 \u0435\u0444\u0444\u0435\u043a\u0442\u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/effects/effect.ts\",\n\"25\": \"\u043c\u0443\u0442\u0430\u0446\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u0430 \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\",\n\"34\": \"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0441\u0430 \u0434\u043b\u044f \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u0444\u0430\u0439\u043b\u0435 types.ts \u0441 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435\u043c\",\n\"53\": \"\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\",\n\"181\": \"\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\",\n\"180\": \"\u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\",\n\"205\": \"\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\",\n\"204\": \"\u0441\u044d\u043c\u043f\u043b\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u043f\u0440\u043e\u0438\u0441\u0445\u043e\u0434\u0438\u0442\u044c \u0432 \u0445\u0440\u0430\u043d\u0438\u043b\u0438\u0449\u0435 \u043f\u043e \u043f\u0443\u0442\u0438 /src/Model/{\u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435}/state.ts\"}"}